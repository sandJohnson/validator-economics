\documentclass[UTF8]{article}
%\usepackage{natbib}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{a4paper}                   % ... or a4paper or a5paper or ... 

%\geometry{landscape}                % Activate for for rotated page geometry
\usepackage{breakurl}     
\usepackage{graphicx}
\usepackage{graphbox}
\usepackage{hyperref}
\usepackage{amssymb}
\usepackage{epstopdf}
\usepackage{algorithm}
\usepackage{amsmath}
\usepackage[noend]{algpseudocode}
\usepackage{enumitem}
\usepackage[acronym]{glossaries}
\usepackage[hang,footnotesize,bf]{caption}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

% Copied from StackOverflow for code snippets 
% ------------------------------------------------------------
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=Python,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}


% Copied from Stack Exchange for ToDo items
% -----------------------------------------------------------
\usepackage{xargs} 
\usepackage[pdftex,dvipsnames]{xcolor}  % Coloured text etc.
% 
\usepackage[colorinlistoftodos,prependcaption,textsize=tiny]{todonotes}
\newcommandx{\unsure}[2][1=]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
\newcommandx{\change}[2][1=]{\todo[linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}}
\newcommandx{\info}[2][1=]{\todo[linecolor=OliveGreen,backgroundcolor=OliveGreen!25,bordercolor=OliveGreen,#1]{#2}}
\newcommandx{\improvement}[2][1=]{\todo[linecolor=Plum,backgroundcolor=Plum!25,bordercolor=Plum,#1]{#2}}
\newcommandx{\feedback}[2][1=]{\todo[linecolor=Goldenrod,backgroundcolor=Goldenrod!25,bordercolor=Coldenrod,#1]{#2}}
\newcommandx{\thiswillnotshow}[2][1=]{\todo[disable,#1]{#2}}


\title{Validator Economics: Variable min validator deposit size\\
\vspace{4pt}
\large EF Academic Grant ID: FY23-1030\\
\vspace{16pt}
DRAFT MODEL, CHALLENGES \& POTENTIAL MITIGATIONS\\
(MAXEB - EIP-7521) }
\vspace{16pt}
\author{Sandra Johnson\\
Consensys Software R\&D}
\date{\today}                                           % Activate to display a given date or no date

\begin{document}
\maketitle


% Acronym definitions
\newacronym{apr}{APR}{annual percentage rate}
\newacronym{bls}{BLS}{Boneh–Lynn–Shacham}
\newacronym{bn}{BN}{Bayesian network}
\newacronym{cbeth}{cbETH}{Coinbase wrapped staked ETH}
\newacronym{cdf}{CDF}{cumulative distribution function}
\newacronym{cl}{CL}{consensus layer}
\newacronym{cpt}{CPT}{conditional probability table}
\newacronym{dvt}{DVT}{distributed validator technology}
\newacronym{eb}{EB}{effective balance}
\newacronym{ef}{EF}{Ethereum Foundation}
\newacronym{eip}{EIP}{Ethereum Improvement Proposal}
\newacronym{el}{EL}{execution layer}
\newacronym{epbs}{ePBS}{enshrined PBS}
\newacronym{ffg}{FFG}{Friendly finality gadget}
\newacronym{fxs}{FXS}{Frax share}
\newacronym{ghost}{GHOST}{Greedy Heaviest-Observed Sub-Tree}
\newacronym{ldo}{LDO}{Lido DAO}
\newacronym{lmd}{LMD}{Latest message driven}
\newacronym{mev}{MEV}{maximal extractable value}
\newacronym{mm}{MM}{MetaMask}
\newacronym{npt}{NPT}{node probability table}
\newacronym{p2p}{p2p}{peer-to-peer}
\newacronym{pbs}{PBS}{proposer builder separation}
\newacronym{pc}{PC}{personal computer}
\newacronym{pdf}{PDF}{probability density function}
\newacronym{pos}{PoS}{proof of stake}
\newacronym{pr}{PR}{pull request}
\newacronym{rig}{RIG}{Robust Incentives Group}
\newacronym{rpl}{RPL}{Rocket Pool}
\newacronym{ssf}{SSF}{single-slot finality}
\newacronym{steth}{stETH}{Lido staked Ether}
\newacronym{ups}{UPS}{uninterruptable power supply}
\newacronym{vrf}{VRF}{verifiable random function}

% ------------------------------------------------------------------------------
\section{Overview}
% ------------------------------------------------------------------------------
This document builds on the previous document, \textit{Milestone 1(EB): Review \& analyse EIP-7521}, addressing each of the identified challenges and applying example scenarios to the expected behaviour cited in blog posts and analysis done to date.

In summary, as mentioned in the previous document, the two key criteria we need to assess for this proposal, and indeed for any proposed strategy to reduce, or cap, the validator set size, are the risks and benefits introduced by that proposal. \\

\noindent
With respect to EIP-7521:
\begin{itemize}
\item \textbf{Risks}: Are risks are being introduced by this proposal? Are there adverse affects on some categories of stakers, or the Ethereum ecosystem?
\item  \textbf{Benefits}: Do all staker categories benefit equally from EIP-7521? Apart from the expected reduction in network load, are there other benefits to the health of the ecosystem?
\end{itemize}

We need to bear in mind that regardless of the risks and benefits, EIP-7521 relies on stakers' willingness to consolidate at least some of their validators. Therefore the messaging around the benefits of consolidation and the perception that the benefits to stakers and the ecosystem definitely outweigh any perceived risks needs to be compelling.

The impact on staking pools, their operational business models, and software changes required to take advantage of the increased maximum will need to be discussed with stakeholders \gls{eb}.

\clearpage
% -------------------------------------------------------------------------------------
\section{Challenges \& Additional analysis requirements}
% -------------------------------------------------------------------------------------
\label{sec:challenges}
In addition to the advantages and disadvantages highlighted in the \textit{ethresear.ch} post, \href{https://ethresear.ch/t/increase-the-max-effective-balance-a-modest-proposal/15801/3}{\textit{Increase the MAX\_EFFECTIVE\_BALANCE – a modest proposal}}, by  Neuder et al  \cite{Neuder2023a}, we propose three topics that may benefit from further in-depth analysis and working examples:

\begin{itemize}
\item Validator duty selection
\thiswillnotshow [inline] {Previously this was "Committee participation"}
\item Rewards \& penalties
\item Ethereum ecosystem \& protocol
\end{itemize}

Each of the three topics will be discussed in more detail. 

% ----------------------------------------------
\subsection{Validator duty selection}
% ----------------------------------------------
In this section we review each of the selection processes to confirm or challenge the anticipated behaviour.

\begin{enumerate}

\item \textit{Proposer selection}: demonstrate that proposer selection still works as designed with partial and full consolidation of validators.

\item \textit{Sync committee selection}: demonstrate that sync committee selection will work as designed even when there is a large increase in Max\gls{eb}.

\item \textit{Slot committees}: Demonstrate that not taking validator weight into account does not have any adverse downstream effects. D'Amato and Neuder state that even if one ``attestation is majority adversarial'', then the worst that can happen is that the attacker will execute a local reorg \cite{damato2023}. Explore in more detail, e.g. use an example or two, to ascertain the effect of variations in slot committee balances with the inclusion, or omission, of fully consolidated stakers. 

\item \textit{Aggregator selection}: Does the selection of more than one virtual validator of a consolidated validator change the probability distribution of sub-committees? Could the probability of fewer than 16 distinct aggregators increase? \\
\textit{Virtual validators}: D'Amato and Neuder's conjecture is that treating consolidated validators as several `virtual' validators yields two main benefits \cite{damato2023}. Demonstrate the correctness of these statements.:
	\begin{itemize}
	\item The total number of aggregators is unchanged, because one consolidated validator would account for only one aggregator.
	\item The probability of at least one honest validator is equivalent to the current probability, because the introduction of virtual validators means that the probability of selecting an honest aggregator is the same as it is currently. The total number of honest validators prior to EIP-7251 is the same as the number of virtual and unconsolidated honest validators.
	\end{itemize}
	
\end{enumerate}


% ----------------------------------------------
\subsection{Rewards \& penalties}
% ----------------------------------------------
\begin{enumerate}

\item \textit{Proposer selection probability}: Demonstrate that this  probability remains unchanged and will not unduly disadvantage small-scale solo stakers \cite{Neuder2023a}. 

\item \textit{Whistleblower reward}: Currently the proposer receives both the whistleblower reward and the proposer reward. Moreover, the whistleblower reward is proportional to the slashed validator's effective balance. How is this reward influenced by the increased maximum effective balance?	

\item \textit{Slashing penalties}: Verify the suitability of the suggested changes to slashing penalties (initial and correlation penalties), as well as those penalties remaining unchanged (attestation and inactivity leak penalties), proposed by Neuder and Monnot \cite{Neuder2023d} using working examples, or other approaches.\\
Moreover, based on the severity of the changed slashing penalties, what situation constitutes an attack on the chain? How do we assess whether the penalties are sufficient to deter adverse behaviour? Are the proposed changes too lenient for large stakers?


\end{enumerate}

% ----------------------------------------------
\subsection{Ethereum ecosystem \& protocol}
% ----------------------------------------------
It is important that there no adverse impacts on the health of the Ethereum ecosystem, and a lot of analysis has already been undertaken to ensure that it remains secure and healthy. As a consequence of EIP-7521, as with all EIPs, changes to the protocol would be required, which the initiators of the proposal have endeavoured to minimise.

\begin{enumerate}

\item \textit{Worst case: Full consolidation}: D'Amato and Neuder identify full consolidation as the worst case scenario when we consider two groups of validators: honest and adversarial validators. Several reasons are given for this conclusion \cite{damato2023}. Using examples or other approaches we need to check the veracity of these statements, viz. that full consolidation:
	\begin{itemize}
	\item increases the probability that one or more committees will be majority dishonest
	\item increases the variance of adversarial balances
	\item increases the variance of the distribution of adversarial weight over committees
	\item due to the above, it follows that it is more likely that there will be ``a positive deviation from the expected adversarial weight in a committee''. Apparently although there may also be ``negative deviations'' the adversarial party is not concerned because it merely aims to control at least one committee.
	\item On the other hand, full consolidation of honest validators maximises the risk of negative deviations from the expected committee weight.
	\item Honest validators benefit from spreading weight evenly across the committees because it minimises the risk of negative deviations.
	\end{itemize}


\item \textit{Discouragement attacks}: Investigate potential griefing, or discouragement, attacks.

\item \textit{Consolidating validators}: There are many challenges around exiting and activation of validators for consolidation. Therefore, as Asgaonkar points out, in-protocol consolidation needs to be in place \cite{Asgaonkar2023}.

\item \textit{Withdrawals}: The automated withdrawal sweep will now skip over consolidated validators with an effective balance below 2, 048 ETH. Therefore, there may be reductions in time to do a full sweep as well as a reduced network load because fewer withdrawals will be initiated. \\
The capability of being able to initiate partial withdrawals for a specified amount appears to be a requirement of large staking pools such as Lido.

\item \textit{Centralisation forces}: 
Centralisation needs to be assessed within the context of this grant and the proposed increase in maximum effective balance, especially with respect to large stakers and staking pools.

\item \textit{Bayesian network model}: Build a \gls{bn} to capture current factors and interactions, including distributions around factors such as uptake of consolidation, current distribution of different categories of stakers, etc. \\
Use the \gls{bn} model to gain insight into questions such as:
	\begin{itemize}
	\item What does the landscape look like if there is no consolidation, but some or all validators decide to compound their rewards? Is this a good or desirable outcome? 
	\item Create some example scenarios that include solo, partial and fully consolidated stakers and how different compositions translate to the selection of validators for specific duties and ideally the probability of dishonest committees.
	\end{itemize}
 
\end{enumerate}

In summary it is important to ensure that small scale solo-stakers are not unduly disadvantaged with the introduction of a 2,048 ETH MaxEB, in terms of proposer selection etc. which may disincentivise the commitment to running a validator. What is being compromised to enable consolidation? Are there other aspects we have not considered? What are the negatives for solo stakers who are considered to be the backbone of Ethereum? Does MaxEB swing it too much in favour of large stakers? One important advantage for solo stakers is that any rewards earned can be autocompounded and if they have insufficient ETH to activate another validator, they can instead top up their validator(s) with amounts less than 32 ETH, e.g. 5 ETH.


% ------------------------------------------------
\include{duties}
% ------------------------------------------------

% ------------------------------------------------
\include{rewardspenalties}
% ------------------------------------------------

% ------------------------------------------------
\include{ecosystem}
% ------------------------------------------------

% ------------------------------------------------
\include{bayesnet}
% ------------------------------------------------


%\clearpage

\section{Bibliography}
% -----------------------------
\nocite{*}
\bibliographystyle{eptcs}
\bibliography{references}

\end{document}
